# 查询改写API接口

## 1. 接口描述
- 接口名称：查询优化
- 接口路径：{BaseURL}/yun/ai/text/query/rewrite
- 请求方式：POST 
- 接口说明：提供基于大模型的查询改写能力，结合历史对话优化当前查询，使其更规范、完整，便于后续检索。

## 2. 输入
### 2.1 请求参数

| 参数名 | 必填 | 类型 | 说明 |
| --- | --- | --- | --- |
| requestId | M | String | 请求ID |
| query | M | String | 待优化的当前查询文本，最大长度限制128字符，不允许全空格，支持中英文和常用标点符号 |
| historyList | O | List<Message> | 历史查询列表，按时间从旧到新排序，最多支持5条，超过5条时只取最新的5条。每条消息的content长度限制128字符 |
| enableExtraction | O | Boolean | 是否开启信息抽取功能，默认为false |
| extractionRules | O | List<Object> | 信息抽取规则对象列表，当enableExtraction为true时生效 |

#### 2.1.1 Message对象结构

| 参数名 | 必填 | 类型 | 说明 |
| --- | --- | --- | --- |
| role | M | String | 消息的角色，枚举值为 "user" 或 "assistant" 或 "system" |
| content | M | String/List<VLContent> | 消息的实际内容，文本大模型的类型为 String，多模态大模型的类型为 List<VLContent> |
| reasoningContent | O | String | 消息思考过程的实际内容 |

#### 2.1.2 extractionRules对象结构

| 参数名 | 必填 | 类型 | 说明 |
| --- | --- | --- | --- |
| desc | M | String | 抽取信息的描述，如"待生成字数的信息" |
| valueType | M | String | 抽取信息的值类型，如"int"、"string"等 |
| keyName | M | String | 抽取信息的键名，如"requireWordNums" |
| defaultValue | O | Any | 抽取信息的默认值，如果抽取失败则返回此值 |

### 2.2 请求示例

```json
{
    "requestId": "query_opt_123456",
    "query": "帮我写一篇15000字的关于人工智能的报告",
    "historyList": [
        {
            "role": "user",
            "content": "人工智能的定义是什么",
            "reasoningContent": null
        },
        {
            "role": "assistant", 
            "content": "人工智能（AI）是指由机器展现出的智能，它模拟人类的认知功能...",
            "reasoningContent": null
        }
    ],
    "enableExtraction": true,
    "extractionRules": [
        {
            "desc": "待生成字数的信息",
            "valueType": "int",
            "keyName": "requireWordNums",
            "defaultValue": -1
        },
        {
            "desc": "报告主题信息",
            "valueType": "string",
            "keyName": "reportTopic",
            "defaultValue": ""
        }
    ]
}
```

## 3. 输出
### 3.1 响应参数

| 参数名 | 必填 | 类型 | 说明 |
| --- | --- | --- | --- |
| code | M | String | 状态码 |
| message | O | String | 状态描述 |
| success | M | Boolean | 是否成功 |
| data | O | Object | 响应数据 |

#### 3.1.1 data结构

| 参数名 | 必填 | 类型 | 说明 |
| --- | --- | --- | --- |
| requestId | M | String | 请求ID |
| result | M | String | 优化后的查询文本 |
| needRewrite | M | Boolean | 是否需要改写，false表示原查询已足够完整规范 |
| processTime | M | Int | 处理耗时（ms） |
| isSummary | O | Boolean | 是否为跨文档总结类型查询，仅当服务端开启总结判断功能时返回 |
| keywords | O | List<String> | 提取的关键词列表，仅当服务端开启总结判断功能时返回 |
| queryType | O | Int | 查询类型：0-其他类，1-总结类，2-建议类，3-发言稿，仅当服务端开启查询分类功能时返回 |
| extractedInfo | O | List<Object> | 提取的信息列表，仅当请求中enableExtraction为true且服务端开启信息抽取功能时返回；为false或不传参，该参数不返回 |

### 3.2 响应示例

```json
{
    "code": "0000",
    "message": "success",
    "success": true,
    "data": {
        "requestId": "query_opt_123456",
        "result": "请帮我撰写一篇15000字的人工智能报告",
        "needRewrite": true,
        "processTime": 156,
        "isSummary": false,
        "keywords": ["人工智能", "报告", "撰写"],
        "queryType": 0,
        "extractedInfo": [
            {
                "requireWordNums": 15000
            },
            {
                "reportTopic": "人工智能"
            }
        ]
    }
}
```

## 4. 错误码说明

| 错误码 | 说明 | 处理建议 |
| --- | --- | --- |
| 0000 | 成功 | - |
| 9999 | 系统内部错误 | 跳过处理 |

注：
- M 表示必填(Mandatory)
- O 表示可选(Optional)
- 所有文本内容使用UTF-8编码
- 常用标点符号包括：,，.。!！?？:：;；()（）[]【】{}「」""''