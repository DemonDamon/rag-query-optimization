graph TD
    A[用户查询] --> B1[查询前分析]
    B1 --> B2[查询类型识别]
    B2 --> C{策略选择路由}
    
    %% 增加查询前分析步骤
    B1 -->|元数据提取| M1[实体识别]
    B1 -->|复杂度评估| M2[复杂性评分]
    B1 -->|意图识别| M3[用户意图分类]
    M1 --> B2
    M2 --> B2
    M3 --> B2
    
    C -->|单一显式证据查询| D[扩展策略]
    C -->|多条显式证据查询| E[分解策略]
    C -->|单一隐式证据查询| F[消歧策略]
    C -->|多条隐式证据查询| G[抽象策略]
    
    %% 扩展策略细化
    D -->|内部扩展| D1[同义词扩展/上下文提示]
    D -->|外部扩展| D2[外部知识库补充]
    D -->|HyDE方法| D3[生成假设性答案作检索]
    D -->|RAG Fusion| D4[多查询融合重排序]
    
    %% 分解策略细化
    E -->|顺序分解| E1[多步骤顺序拆分]
    E -->|并行分解| E2[并行子查询生成]
    E -->|依赖分解| E3[构建查询依赖图]
    E -->|语义分解| E4[语义单元提取分解]
    
    %% 消歧策略细化
    F -->|语义消歧| F1[上下文感知消歧]
    F -->|多轮对话消歧| F2[历史对话整合消歧]
    F -->|实体消歧| F3[命名实体链接消歧]
    F -->|Reverse HyDE| F4[反向假设查询生成]
    
    %% 抽象策略细化
    G -->|核心概念识别| G1[抽象化查询概括]
    G -->|范围扩大| G2[高层次主题抽象]
    G -->|统一表示| G3[创建结构化查询表示]
    
    %% 汇总到优化后查询
    D1 --> H[优化后查询集合]
    D2 --> H
    D3 --> H
    D4 --> H
    E1 --> H
    E2 --> H
    E3 --> H
    E4 --> H
    F1 --> H
    F2 --> H
    F3 --> H
    F4 --> H
    G1 --> H
    G2 --> H
    G3 --> H
    
    %% 增加结果融合与排序步骤
    H --> H1[查询合并与融合]
    H1 --> I[检索阶段]
    I --> J1[多模型并行检索]
    J1 --> J2[检索结果重排序]
    J2 --> K[生成回答]
    
    %% 增强评估与反馈环节
    K --> L1[结果可信度评估]
    L1 --> L2[查询与结果对齐度分析]
    L2 --> L3[学习型反馈调整]
    L3 --> A